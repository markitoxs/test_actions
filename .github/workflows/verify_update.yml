name: Verify VERSION file

on:
  pull_request:
    branches: [ master ]

jobs:
  check_that_version_file_is_updated:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
      with:
        fetch-depth: 1

    # compare what files have changed 
    - name: Make sure VERSION is changed if terraform files included
      run: |
        git fetch -q origin ${{ github.base_ref }}
        list=$(git diff origin/${{ github.base_ref }} --name-only)
        [ $(echo $list | grep .tf | wc -l) -ne '0' ] && 
        [ $(echo $list | grep VERSION | wc -l) -eq '0' ] && 
        echo "[ERROR] *.tf files modified but VERSION didnt change" &&
        exit 1
